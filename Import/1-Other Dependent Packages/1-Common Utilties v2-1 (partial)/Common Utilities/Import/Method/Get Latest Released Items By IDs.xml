<AML>
 <Item type="Method" id="51AAE5A44D924C99BBE9682768EA7F59" action="add">
  <comments>resolves to latest released items of a given id or list of ids</comments>
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA['Get Latest Released Items of ID
'
' item context must contain
' "type" attribute
' "id" attribute or <id> property
'       allows <id> property to contain comma separated list of ids - with single quote text deliminters
'       id property attribute must then have "condition"= "in"
'
'
' Can be used with versionable Item Types. 1st step of logic will determine latest released generatins of all
' item ids passed in. 2nd step will do a "get" action for all latest released ids.
'
'NOTE: works also if item type is a Poly Item

'MethodTemplateName=VBMain;
Dim res As Item
Dim inn As Innovator

Function Main() As Item
  'System.Diagnostics.Debugger.Break()
  Dim itemIds As String = Me.getProperty("id","")
  Dim itemType As String = Me.GetType()
  
  if itemIds <> "" and itemIds.indexOf(",") > 0 then
    If Me.getPropertyAttribute("id","condition","") <> "in" Then Return Me.getInnovator().newError("In calling context the id condition attribute is missing !")
  Else
    If itemIds = "" Then itemIds = Me.getID() 'single item id
    If itemIds.IndexOf("'") < 0 Then itemIds = "'" & itemIds & "'"
  End If
  
  'Step 1 - get list of ids of latest released generations
  Dim resIds As String = "##"

    Dim tableName As String = "[" & CCO.DB.GenerateTableName(itemType) & "]"
    Dim SQLstr As String = "SELECT " & tableName & ".id," & tableName & ".config_id," & tableName & ".generation"
  
    SQLstr = SQLstr & " FROM " & tableName
    SQLstr = SQLstr & " WHERE " & tableName & ".config_id IN "
    SQLstr = SQLstr & "(SELECT " & tableName & ".config_id FROM " & tableName
    SQLstr = SQLstr & " WHERE " & tableName & ".id in (" & itemIds & "))"
    SQLstr = SQLstr & " AND " & tableName & ".generation like '%'"
    SQLstr = SQLstr & " AND " & tableName & ".is_released='1'"
    'order by config and generation DESC is IMPORTANT for next logic !!!  do not change
    SQLstr = SQLstr & " ORDER BY " & tableName & ".config_id," & tableName & ".generation DESC"

    res = Me.getInnovator().applySQL(SQLstr)

    Dim i As Integer
    Dim listOfConfigIds As String = ""
    For i = 0 To res.getItemCount()-1
      'only add the id of the first generation found for a config_id (this will be the max generation since ordering is DESC)
      If listOfConfigIds.indexOf(res.getItemByIndex(i).getProperty("config_id","")) < 0 Then
    	 resIds = resIds & "," & res.getItemByIndex(i).getProperty("id","")
	     listOfConfigIds = listOfConfigIds & "," & res.getItemByIndex(i).getProperty("config_id","")
      End If
    Next i
  
  resIds = resIds.Replace("##,","")
  resIds = "'" & resIds.Replace(",","','") & "'"
  
  'Step 2 - get Items of latest released ids
  Me.setProperty("id", resIds)
  Me.setPropertyAttribute("id","condition","in")
  Me.setAction("get")
  
  Return Me.apply()
  
End Function
  
]]></method_code>
  <method_type>VB</method_type>
  <name>Get Latest Released Items By IDs</name>
 </Item>
</AML>