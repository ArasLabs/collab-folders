<AML>
 <Item type="Method" id="C7EB19DADE104E59BD67CD234BD8B090" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA[// populate logic
if (! document.isEditMode) {
  hideCreateNewAction("crateNewItemHref",true);
  return;
}
else {
  // if folder is a template - hide the Href action and disable property
  var element = document.getElementsByName("is_template")[0];
  if (element) {
    if (element.checked) {
      hideCreateNewAction("crateNewItemHref",true);
      return;
    }
  }

  // if link contains value - hide the Href action and disable property
  var val =  document.getElementsByName(window.itemLinkProperty)[0].value;
  if (!val || val === undefined){val="";}
  if (val !== "")
  {
    //debugger;
    hideCreateNewAction("crateNewItemHref",true);
  }
  else
  {
    hideCreateNewAction("crateNewItemHref",false);
  }
}

// API function called from HTML field on form
window.createNewItem = function(newItemType,itemLinkPropertyOnForm,presetProperties,showCreateDialog){
  var val = document.forms[0].is_root.checked;
  if (!val) {
    alert ("This function only works for 'top' level Item Folders !");
    return;
  }

  var tmpItm = document.item;
  var aml = tmpItm.xml;
  thisItem = top.aras.newIOMItem("","");
  thisItem.loadAML(aml);

  var thisItemconfigId = thisItem.getProperty("config_id","");
  if (thisItemconfigId === "") {thisItemconfigId=thisItem.getID();}
  
  if (thisItemconfigId === "") {
    alert ("Cannot determine 'configId', of this Item Folder!");
    return;
  }

  var teamSystemId = createItemFolderTeamItem (thisItemconfigId, presetProperties);
  if (teamSystemId.indexOf("ERROR") >= 0) {
    alert (teamSystemId);
    return;
  }

  handleItemChange(itemLinkPropertyOnForm,teamSystemId);
  thisItem.setProperty(itemLinkPropertyOnForm,teamSystemId);

  return;
};

// ----Helper Functions --
function hideCreateNewAction (hrefHTMLName, bHide) {
//  var element = document.getElementsByName("html_search_change_order")[0];
  var element = document.getElementsByName(hrefHTMLName)[0];
  if (element) {
    var style = element.style;
    if (style) {
      if (bHide) {style.display = "none";}
      else {style.display = "block";        
      }
    }
  }
  return;
}

//---------------
function createItemFolderTeamItem (folderItemConfigId,presetProperties)
{
  var presetProperty = "";
  var presetValue = "";
  if (presetProperties !== "") {
    var pos1;
	pos1 = presetProperties.indexOf(":");
	if (pos1 > 0) {
	  presetValue = presetProperties.substring(pos1+1,presetProperties.length);
	  presetProperty = presetProperties.substring(0,pos1);
	}
  }

  //try to find existing team item of this Folder
  var amlCmd = top.aras.newIOMItem("Team","get");
  amlCmd.setProperty(presetProperty,"FD_" + presetValue);
  amlCmd.setProperty("private_team_item_id_string", folderItemConfigId);
  amlCmd.setAttribute("select","id");
  amlCmd = amlCmd.apply();

  var teamId = "";
  if (amlCmd.getItemCount() === 0) {
    amlCmd = top.aras.newIOMItem("Team","Item Folder CreateNew Team");
    amlCmd.setProperty(presetProperty,"FD_" + presetValue);
    amlCmd.setProperty("private_team_item_id_string", folderItemConfigId);
    amlCmd = amlCmd.apply();
    if (amlCmd.isError()) {return "ERROR:" + amlCmd.getErrorString();}
  }
  teamId = amlCmd.getItemByIndex(0).getAttribute("id","");

  return teamId; 
}
]]></method_code>
  <method_type>JavaScript</method_type>
  <name>Handle newTeam on Folder Form</name>
 </Item>
</AML>