<AML>
 <Item type="Method" id="DED68DD389B24E198757710DCB5D6EC8" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA['MethodTemplateName=VBMain;
' called: onAferDelete
'   requires method: 'Add Props to Folder BeforeDelete' to be run onBeforeDelete
Dim inn As Innovator = Me.getInnovator()
  
Function Main() As Item
  'System.Diagnostics.Debugger.Break()
 
  Dim ItemConfigId As String = Me.getProperty("config_id","")
  Dim ItemId As String = Me.GetID()

  ' delete the Team Item associated with this folder
  Dim amlCmd As Item = inn.newItem("Team","delete")
  
  Dim whereStr As String = "[Team].description like '%" & ItemConfigId  & "%'"
  whereStr = whereStr  & " or [Team].private_team_item_id_string like '%" & ItemConfigId  & "%'"
  amlCmd.setAttribute("where",whereStr)

  ' run as root
  Dim plmIdentity As Aras.Server.Security.Identity  = Aras.Server.Security.Identity.GetByName("Super User")
  Dim PermissionWasSet As Boolean  = Aras.Server.Security.Permissions.GrantIdentity(plmIdentity)

  Try
    amlCmd = amlCmd.apply()  'if team still linked to other folders, project, or programs, this may fail
  Catch ex As Exception
    Return Me
  End Try
  
  ' Revoke 'Aras PLM' permissions
  If (PermissionWasSet) Then Aras.Server.Security.Permissions.RevokeIdentity(plmIdentity)
  
  Return Me

End Function

]]></method_code>
  <method_type>VB</method_type>
  <name>Delete Folder related Team</name>
 </Item>
</AML>