<AML>
 <Item type="Method" id="2F3746335CDD47109802367D008A8BF2" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA[' add null relationship for each value in List "Folder Controlled Item"
'System.Diagnostics.Debugger.Break()
Dim aml As String
Dim qry As Item = Me.newItem("Value","get")
aml = "<Item type='Value' action='get' select='value,label' ><source_id><Item type='List' action='get' select='id' ><name>Folder Controlled Item</name></Item></source_id></Item>"
qry.loadAML(aml)
qry = qry.apply()
If qry.isError() Then Return qry
   
Dim i As Integer   
Dim typesIdList As String = ""
Dim sepChar As String = ""
For i=0 To  qry.getItemCount() -1
  Dim typeId As String = qry.getItemByIndex(i).getProperty("value","")
  If (typesIdList.IndexOf(typeId) < 0) Then
    typesIdList = typesIdList & sepChar & typeId
    sepChar = ","
  End If
Next i
If typesIdList = "" Then Return Me

typesIdList = "'" & typesIdList.Replace(",","','") & "'"
aml = "<Item type=""ItemType"" action=""get"" select=""name"" ><id condition=""in"">" & typesIdList & "</id></Item>"
qry = Me.newItem("","")
qry.loadAML(aml)
qry = qry.apply()
If qry.isError() Then Return qry

Dim itemTypesAdded As String = ""
For i=0 To  qry.getItemCount() -1
  Dim controlledItemConfig As Item = Me.newItem("","")
  Dim itemTypeName As String = qry.getItemByIndex(i).getProperty("name","") ' this is the ItemType name of the poly items (language neutral)
  
  ' due to config issues, poly item config could have an ItemType listed multiple times. Only add one row for each type.
  If (itemTypesAdded.IndexOf(itemTypeName) < 0) Then
  
    aml = "<Item type=""Item Folder Tmpl CtrItemConfig"" action=""merge"" "
    aml = aml & "where=""[Item_Folder_Tmpl_CtrItemConfig].source_id='" & Me.getID() & "' and [Item_Folder_Tmpl_CtrItemConfig].controlled_item_type='" & itemTypeName & "' "" >"
    aml = aml & "<controlled_item_type>" & itemTypeName & "</controlled_item_type>"   	
    aml = aml & "<source_id>" & Me.getID() & "</source_id>"   	
    aml = aml & "</Item>"   	
    controlledItemConfig.loadAML(aml)

    Dim methodName As String = ""
    Select Case (itemTypeName)
     Case "Document"
       methodName = "Folder Template Default DocNum"  
     Case "CAD"
       methodName = "Folder Template Default CADNum"
     Case "Part"
       methodName = "Folder Template Default PartNum"
    End Select

    If methodName <> "" Then
      Dim methItem As Item = Me.newItem("Method","get")
      methItem.setProperty("name",methodName) 
      methItem = methItem.apply()' get current generation of this method
      If Not methItem.isError() Then
        controlledItemConfig.setProperty("auto_number_method",methItem.getID())
      End If
    End If
  
    controlledItemConfig = controlledItemConfig.apply()
    If controlledItemConfig.isError() Then Return controlledItemConfig

    itemTypesAdded = "," & itemTypeName
  End If 
Next i

Return Me]]></method_code>
  <method_type>VB</method_type>
  <name>Folder Template AddCtrItemConifg</name>
 </Item>
</AML>