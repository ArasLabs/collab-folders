<AML>
 <Item type="Method" id="C7EB19DADE104E59BD67CD234BD8B090" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA[// populate logic
itemLinkProperty = "team_id";

if (! document.isEditMode) {
  hideCreateNewAction("createNewItemHref",true);
  return;
}
else {
  // if folder is a template - hide the Href action and disable property
  var element = document.getElementsByName("is_template")[0];
  if (element) {
    if (element.checked) {
      hideCreateNewAction("createNewItemHref",true);
      return;
    }
  }

  // if link contains value - hide the Href action and disable property
  var val =  document.getElementsByName(itemLinkProperty)[0].getElementsByTagName("input")[0].value;
  if (!val || val === undefined){val="";}
  if (val !== "")
  {
    //debugger;
    hideCreateNewAction("createNewItemHref",true);
  }
  else
  {
    hideCreateNewAction("createNewItemHref",false);
  }
}
window.createNewItemAndLinkToProperty = function(){
    var folderName = document.getElementsByName("name")[0].getElementsByTagName("input")[0].value;
	
	if (!folderName || folderName === undefined || folderName === "")
	{
	  alert("Cannot create new Item. Field 'name' on this form does not have a value !");
	  return;
	}
    LinkNewTeamToFolder(folderName);
  };

// API function called from HTML field on form
LinkNewTeamToFolder = function(folderName){
  var tmpItm = document.item;
  var aml = tmpItm.xml;
  var thisItem = top.aras.newIOMItem("","");  // holds the Item Folder context
  thisItem.loadAML(aml);

  var thisFolderConfigId = thisItem.getProperty("config_id","");
  var thisFolderNumber = thisItem.getProperty("item_number","");
  if (thisFolderConfigId === "") {thisFolderConfigId=thisItem.getID();}
  
  if (thisFolderConfigId === "") {
    alert ("Cannot determine 'configId', of this Item Folder!");
    return;
  }

  var teamSystemId = createItemFolderTeamItem (thisFolderConfigId, thisFolderNumber, "name:"+folderName);
  if (teamSystemId.indexOf("ERROR") >= 0) {
    alert (teamSystemId);
    return;
  }

  handleItemChange(itemLinkProperty,teamSystemId);
  thisItem.setProperty(itemLinkProperty,teamSystemId);
  hideCreateNewAction("createNewItemHref",true);
  return;
};

// ----Helper Functions --
//---------------
function createItemFolderTeamItem (folderItemConfigId,folderItemNumber,presetProperties)
{
  var presetProperty = "";
  var presetValue = "";
  if (presetProperties !== "") {
    var pos1;
	pos1 = presetProperties.indexOf(":");
	if (pos1 > 0) {
	  presetValue = presetProperties.substring(pos1+1,presetProperties.length);
	  presetProperty = presetProperties.substring(0,pos1);
	}
  }

  //try to find existing team item of this Folder
  var amlCmd = top.aras.newIOMItem("Team","get");
  amlCmd.setProperty("private_team_item_id_string", folderItemConfigId);
  amlCmd.setAttribute("select","id");
  amlCmd = amlCmd.apply();

  var teamName = "FT_" + presetValue + " (" +folderItemNumber + ")";
  var teamId = "";
  if (amlCmd.getItemCount() <= 0) {
    //create new team for this Folder
    amlCmd = top.aras.newIOMItem("Team","Item Folder CreateNew Team");
    amlCmd.setProperty(presetProperty,teamName);
    amlCmd.setProperty("private_team_item_id_string", folderItemConfigId);
    amlCmd = amlCmd.apply();
    if (amlCmd.isError()) {return "ERROR:" + amlCmd.getErrorString();}
  }
  teamId = amlCmd.getItemByIndex(0).getAttribute("id","");

  return teamId; 
}

//-------
function hideCreateNewAction (hrefHTMLName, bHide) {
  var element = document.getElementsByName(hrefHTMLName)[0];
  if (element) {
    var style = element.style;
    if (style) {
      if (bHide) {style.display = "none";}
      else {style.display = "block";        
      }
    }
  }
  return;
}

]]></method_code>
  <method_type>JavaScript</method_type>
  <name>Handle newTeam on Folder Form</name>
 </Item>
</AML>